import{CONFIG,$,$$,debounce,setExpanded,storage,showToast,validateEmail,validatePhone,throttle}from './js/utils.js';import{translations}from './js/translations.js';import{imageOptimizer}from './js/imageOptimization.js';(function(){'use strict';let currentLanguage=CONFIG.DEFAULT_LANGUAGE;const LoadingOverlay={overlay:null,init(){this.overlay=$('#loading-overlay');if(!this.overlay){this.overlay=document.createElement('div');this.overlay.id='loading-overlay';this.overlay.className='loading-overlay';this.overlay.innerHTML='<div class="loading-spinner"></div>';document.body.appendChild(this.overlay);}},show(){this.init();this.overlay.style.display='flex';},hide(){if(this.overlay){this.overlay.style.display='none';}}};function scrollToForm(){const form=$('#contact-form');if(form){const formPosition=form.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:formPosition-100,behavior:'smooth'});}}function scrollToIntroduction(){const intro=$('#introduction');if(intro){const introPosition=intro.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:introPosition-100,behavior:'smooth'});}}function toggleLanguageMenu(){const menu=$('#language-menu');if(menu){const isExpanded=menu.getAttribute('aria-expanded')==='true';setExpanded(menu,!isExpanded);menu.classList.toggle('active');}}function changeLanguage(lang){if(!translations[lang])return;currentLanguage=lang;storage.set(CONFIG.STORAGE_KEY,lang);$$('.lang-button').forEach(btn=>{btn.classList.toggle('active',btn.dataset.lang===lang);});const navLinks=$$('#site-nav a');const translatedLinks=translations[lang].navLinks;navLinks.forEach((link,index)=>{if(translatedLinks[index]){link.textContent=translatedLinks[index];}});const introSpans=$$('.introduction-container span');const translatedIntroSpans=translations[lang].introductionSpans;introSpans.forEach((span,index)=>{if(translatedIntroSpans[index]){span.textContent=translatedIntroSpans[index];}});const placeHeader=$('#place-header');const placeSpans=$$('.place-container span');if(placeHeader)placeHeader.textContent=translations[lang].placeHeader;placeSpans.forEach((span,index)=>{if(translations[lang].placeSpans[index]){span.textContent=translations[lang].placeSpans[index];}});const activitiesHeader=$('#activities-header');const activitiesSpans=$$('.activities-container span');if(activitiesHeader)activitiesHeader.textContent=translations[lang].activitiesHeader;activitiesSpans.forEach((span,index)=>{if(translations[lang].activitiesSpans[index]){span.textContent=translations[lang].activitiesSpans[index];}});const gastronomyHeader=$('#gastronomy-header');const gastronomySpans=$$('.gastronomy-container span');if(gastronomyHeader)gastronomyHeader.textContent=translations[lang].gastronomyHeader;gastronomySpans.forEach((span,index)=>{if(translations[lang].gastronomySpans[index]){span.textContent=translations[lang].gastronomySpans[index];}});const plansHeader=$('#plans-header');const plansSpans=$$('.plans-container span');if(plansHeader)plansHeader.textContent=translations[lang].plansHeader;plansSpans.forEach((span,index)=>{if(translations[lang].plansSpans[index]){span.textContent=translations[lang].plansSpans[index];}});const opinionsHeader=$('#opinions-header');const opinionsSpans=$$('.opinions span');if(opinionsHeader)opinionsHeader.textContent=translations[lang].opinionsHeader;opinionsSpans.forEach((span,index)=>{if(translations[lang].opinionsSpans&&translations[lang].opinionsSpans[index]){span.textContent=translations[lang].opinionsSpans[index];}});const formHeader=$('#form-header');const formSpans=$$('.form span');if(formHeader)formHeader.textContent=translations[lang].formHeader;formSpans.forEach((span,index)=>{if(translations[lang].formSpans&&translations[lang].formSpans[index]){span.textContent=translations[lang].formSpans[index];}});const nameLabel=$('#name-label');const emailLabel=$('#email-label');const phoneLabel=$('#phone-label');const messageLabel=$('#message-label');const submitBtn=$('#submit-btn');if(nameLabel)nameLabel.textContent=translations[lang].formLabels.name;if(emailLabel)emailLabel.textContent=translations[lang].formLabels.email;if(phoneLabel)phoneLabel.textContent=translations[lang].formLabels.phone;if(messageLabel)messageLabel.textContent=translations[lang].formLabels.message;if(submitBtn)submitBtn.textContent=translations[lang].formLabels.submit;const nameInput=$('#name');const emailInput=$('#email');const phoneInput=$('#phone');const messageInput=$('#message');if(nameInput)nameInput.placeholder=translations[lang].formPlaceholders.name;if(emailInput)emailInput.placeholder=translations[lang].formPlaceholders.email;if(phoneInput)phoneInput.placeholder=translations[lang].formPlaceholders.phone;if(messageInput)messageInput.placeholder=translations[lang].formPlaceholders.message;}class Carousel{constructor({trackSelector,prevBtnSelector,nextBtnSelector,slidesPerView={mobile:1,tablet:2,desktop:4},auto=true,interval=CONFIG.CAROUSEL.DEFAULT_INTERVAL,infinite=false}){this.track=$(trackSelector);this.prevBtn=$(prevBtnSelector);this.nextBtn=$(nextBtnSelector);if(!this.track||!this.prevBtn||!this.nextBtn)return;this.slides=Array.from(this.track.querySelectorAll('.carousel-slide'));if(!this.slides.length)return;this.slidesPerView=slidesPerView;this.auto=auto;this.interval=interval;this.infinite=infinite;this.currentIndex=0;this.autoScrollInterval=null;this.resumeTimer=null;this.init();}init(){if(this.infinite){this.duplicateSlides();}else{this.originalSlidesCount=this.slides.length;}this.setupEventListeners();this.updatePosition();if(this.auto)this.startAuto();}duplicateSlides(){const originalSlides=Array.from(this.slides);this.originalSlidesCount=originalSlides.length;originalSlides.forEach(slide=>{const clone=slide.cloneNode(true);this.track.appendChild(clone);});this.slides=Array.from(this.track.querySelectorAll('.carousel-slide'));}setupEventListeners(){this.prevBtn.addEventListener('click',()=>{this.changeSlide(-1);this.pauseTemporarily();});this.nextBtn.addEventListener('click',()=>{this.changeSlide(1);this.pauseTemporarily();});const onResize=debounce(()=>{this.updatePosition();if(this.auto)this.startAuto();},CONFIG.CAROUSEL.RESIZE_DEBOUNCE);window.addEventListener('resize',onResize);this.track.addEventListener('mouseenter',()=>this.stopAuto());this.track.addEventListener('mouseleave',()=>this.startAuto());['pointerdown','touchstart'].forEach(evt=>{this.track.addEventListener(evt,()=>this.pauseTemporarily(),{passive:true});});}getStepSize(){const firstSlide=this.slides[0];if(!firstSlide)return 0;const slideWidth=firstSlide.getBoundingClientRect().width;const styles=window.getComputedStyle(this.track);const gapValue=parseFloat(styles.columnGap||styles.gap||'0');const gap=Number.isNaN(gapValue)? 0:gapValue;return slideWidth+gap;}updatePosition(){const step=this.getStepSize();this.track.style.transition='transform 0.5s ease-in-out';this.track.style.transform=`translateX(-${this.currentIndex*step}px)`;}getSlidesToShow(){const width=window.innerWidth;if(width<=CONFIG.BREAKPOINTS.MOBILE)return this.slidesPerView.mobile ?? 1;if(width<=CONFIG.BREAKPOINTS.TABLET)return this.slidesPerView.tablet ?? this.slidesPerView.mobile ?? 1;return this.slidesPerView.desktop ?? 4;}changeSlide(direction){if(this.infinite){this.currentIndex+=direction;if(this.currentIndex>=this.originalSlidesCount){this.currentIndex=0;this.track.style.transition='none';this.updatePosition();this.track.offsetHeight;this.track.style.transition='transform 0.5s ease-in-out';}else if(this.currentIndex<0){this.currentIndex=this.originalSlidesCount-1;this.track.style.transition='none';this.updatePosition();this.track.offsetHeight;this.track.style.transition='transform 0.5s ease-in-out';}else{this.updatePosition();}}else{const totalSlides=this.slides.length;const slidesToShow=this.getSlidesToShow();const maxIndex=Math.max(0,totalSlides-slidesToShow);this.currentIndex+=direction;if(this.currentIndex>maxIndex){this.currentIndex=0;}else if(this.currentIndex<0){this.currentIndex=maxIndex;}this.updatePosition();}}startAuto(){if(!this.auto)return;this.stopAuto();this.autoScrollInterval=setInterval(()=>this.changeSlide(1),this.interval);}stopAuto(){clearInterval(this.autoScrollInterval);}pauseTemporarily(){this.stopAuto();clearTimeout(this.resumeTimer);this.resumeTimer=setTimeout(()=>{this.startAuto();},CONFIG.CAROUSEL.PAUSE_DURATION);}}function initNavigation(){const menuToggle=$('.menu-toggle');const siteNav=$('#site-nav');if(menuToggle&&siteNav){menuToggle.addEventListener('click',()=>{const isExpanded=menuToggle.getAttribute('aria-expanded')==='true';setExpanded(menuToggle,!isExpanded);siteNav.classList.toggle('active');menuToggle.classList.toggle('active');});}$$('#site-nav a').forEach(link=>{link.addEventListener('click',()=>{siteNav.classList.remove('active');menuToggle.classList.remove('active');setExpanded(menuToggle,false);});});document.addEventListener('click',(e)=>{if(!siteNav.contains(e.target)&&!menuToggle.contains(e.target)){siteNav.classList.remove('active');menuToggle.classList.remove('active');setExpanded(menuToggle,false);}});}function initFormSubmission(){const form=$('#contact-form');if(!form)return;form.addEventListener('submit',async(e)=>{e.preventDefault();const formData=new FormData(form);const data={name:formData.get('name'),email:formData.get('email'),phone:formData.get('phone'),people:formData.get('people'),message:formData.get('message')};if(!data.name||!data.email||!data.phone||!data.people||!data.message){showToast(translations[currentLanguage].formValidation.required,'error');return;}if(!validateEmail(data.email)){showToast(translations[currentLanguage].formValidation.emailInvalid,'error');return;}if(data.phone&&!validatePhone(data.phone)){showToast(translations[currentLanguage].formValidation.phoneInvalid,'error');return;}LoadingOverlay.show();try{const response=await fetch(CONFIG.API.EMAIL_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify(data)});if(response.ok){showToast(translations[currentLanguage].formSuccess,'success');form.reset();}else{throw new Error('Server error');}}catch(error){console.error('Form submission error:',error);showToast(translations[currentLanguage].formError,'error');}finally{LoadingOverlay.hide();}});}function initRevealAnimations(){const observerOptions={threshold:CONFIG.INTERSECTION_THRESHOLD,rootMargin:'0px 0px-50px 0px'};const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('revealed');}});},observerOptions);$$('.reveal').forEach(el=>observer.observe(el));}function initScrollToTop(){const scrollToTopBtn=$('#scroll-to-top');if(!scrollToTopBtn)return;const handleScroll=throttle(()=>{if(window.pageYOffset>300){scrollToTopBtn.classList.add('visible');}else{scrollToTopBtn.classList.remove('visible');}},100);window.addEventListener('scroll',handleScroll);scrollToTopBtn.addEventListener('click',()=>{window.scrollTo({top:0,behavior:'smooth'});});}function initToastNotifications(){const container=$('#toast-container');if(!container){const toastContainer=document.createElement('div');toastContainer.id='toast-container';toastContainer.className='toast-container';document.body.appendChild(toastContainer);}}function initVideoOverlay(){const video=$('#hero-video');const overlay=$('#video-overlay');const playButton=$('#play-button');if(!video||!overlay||!playButton)return;const currentTime=new Date().getTime();const videoSrc=video.querySelector('source');if(videoSrc){const baseSrc=videoSrc.src.split('?')[0];videoSrc.src=`${baseSrc}?v=${currentTime}`;video.load();}const hideOverlay=()=>{overlay.classList.add('hidden');};const showOverlay=()=>{overlay.classList.remove('hidden');};playButton.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();video.play().then(()=>{hideOverlay();}).catch((error)=>{console.warn('Error al reproducir el video:',error);video.controls=true;hideOverlay();});});overlay.addEventListener('click',(e)=>{if(e.target===overlay){playButton.click();}});video.addEventListener('play',hideOverlay);video.addEventListener('pause',showOverlay);video.addEventListener('ended',showOverlay);if(video.paused){showOverlay();}}document.addEventListener('DOMContentLoaded',()=>{const savedLang=storage.get(CONFIG.STORAGE_KEY);const initialLang=savedLang&&translations[savedLang]? savedLang:CONFIG.DEFAULT_LANGUAGE;changeLanguage(initialLang);initNavigation();new Carousel({trackSelector:'.carousel-track.activities',prevBtnSelector:'.prev-btn-activities',nextBtnSelector:'.next-btn-activities',slidesPerView:{mobile:1,tablet:2,desktop:4},auto:true,interval:4000,infinite:true});new Carousel({trackSelector:'.carousel-track.gastronomy',prevBtnSelector:'.prev-btn-gastronomy',nextBtnSelector:'.next-btn-gastronomy',slidesPerView:{mobile:1,tablet:2,desktop:4},auto:true,interval:4000,infinite:true});new Carousel({trackSelector:'.carousel-track.plans',prevBtnSelector:'.prev-btn-plans',nextBtnSelector:'.next-btn-plans',slidesPerView:{mobile:1,tablet:1,desktop:4},infinite:false});new Carousel({trackSelector:'.carousel-track.opinions',prevBtnSelector:'.prev-btn-opinions',nextBtnSelector:'.next-btn-opinions',slidesPerView:{mobile:1,tablet:1,desktop:1},auto:true,interval:5000,infinite:false});initVideoOverlay();initFormSubmission();initRevealAnimations();initScrollToTop();initToastNotifications();imageOptimizer;});if('serviceWorker' in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.register('/serviceWorker.js').then(registration=>{console.log('SW registered:',registration);}).catch(registrationError=>{console.log('SW registration failed:',registrationError);});});}window.scrollToForm=scrollToForm;window.scrollToIntroduction=scrollToIntroduction;window.toggleLanguageMenu=toggleLanguageMenu;window.changeLanguage=changeLanguage;})();